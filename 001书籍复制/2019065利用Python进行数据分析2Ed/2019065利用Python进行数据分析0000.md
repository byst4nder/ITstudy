## 作者介绍

Wes Mckinney 是一个在纽约工作的软件开发者兼企业家。2007 年在麻省理工学院取得数学本科学位后，他在康涅狄格州格林尼治市的 AQR 资本管理公司做量化金融的工作。由于对烦琐的数据分析工具感到沮丧，他学习了 Python 并开始构建后来成为 pandas 的项目。目前，他是 Python 数据社区的一名活跃成员，同时也是一名在数据分析、金融和统计计算应用中使用 Python 的倡导者。

后来，Wes 成为 Datapad 的联合创始人和 CEO，该公司的技术资产和团队在 2014 年被 Cloudera 收购。他从此投身到大数据技术中，参加了 Apache 软件基金会的 Apache Arrow 和 Apache Parquet 项目的项目管理委员会。2016 年，他加入了细约的 Two Sigma 投资公司，在这里他继续为了加快、简化数据分析从事开源软件相关工作。

## 第 2 版新内容

本书第版出版于 2012 年，彼时基于 Python 的开源数据分析库（例如 pandas）仍然是一发展迅速的新事物。在本次更新、拓展的第 2 版中，我在一些章节内进行了修改，以解释过去 5 年中发生的不兼容的変更、弃用和一些新特性。此外，我还添加了新内容，用以介绍在不成熟的工具。最后，我会避免把一些新兴的或者不太可能走向成熟的开源项目写入本书。我希望本版的读者能够发现本书内容在 2020 年或者 2021 年仍然几乎像在 2017 年一样适用。

2 版中的主要更新包括：

1. 所有的代码，包括把 Python 的教程更新到了 Python3.6 版本。

2. 更新了 Python 第三方发布版 Anaconda 和其他所需 Python'包的安装指引。

3. 更新 pandas 库到 2017 年的最新版。

4. 新增一章，关于更多高级 pandas 工具和一些使用提示。

5. 新增 statsmodels 和 scikit-learn 的简明使用介绍。

6. 除了以上更新内容，我还重新组织了第 1 版的部分重要内容，使本书对新手来说更易于理解。

## 译者序

2014 年我刚走上工作岗位时，Pythons 数据分析技术开始在中国流行，越来越多的人开始学习和使用这门技术。当时，Python 的主流版本是 2.7.3.4 版本刚刚发布，但认可度和流行度并不高。很幸运，我阅读了本书的第 1 版。第 1 版基于 Python2.7，介绍了大量的实用技术，包括 pandas、Numpyi 的使用等。在实践中，书中的技术被我大量应用，帮助我更快更好地处理了各类数据。

时过境迁，从本书英文版第 1 版 2012 年出版至今，已经过去了 6 年。这 6 年中，Python 的主流版本从 2.7 升级到了 3.6。无论是否情愿，大部分 Pythoner 都不得不学会适应新版本；而 pandas 则从 0.1.0 版本送代到如今的 0.22.0 版本。版本号的持续増加意味着新技术、新特性的不断丰富。

举例来说，将帯有多层索引的数据透视表写入 Excel 在 2015 年之前是无法使用 pandas 完成的，在 0.17 版本后该功能被加入。因此，本书的第一版内容已经略显落后。

2017 年 10 月下旬，本书作者 Wes Mckinney 先生更新了本书的第 2 版。在第 2 版中，他将 Python 版本更新到 3.6，介绍了 pandas 的一些新接口和功能，并新增了大量现实世界的数据分析实例，以确保本书的可实践性。我在 2017 年 11 月 18 日接到出版社的翻译邀请后便开始了翻译工作。Mckinney 先生的写作风格朴实、形象，因而我的翻译过程较为顺畅，但书中部分口语化的叙述也因为中英文表达方式的差异而增加了意译的难度

在本书翻译过程中，我得到了很多帮助。首先要感谢华章公司的王春华编辑和冯秀泳编辑，他们在翻译过程中给了我耐心指导。在审稿时，来自国内 Python 圈的朋友们对本书进行了仔细而全面的审核，他们是网易数据工程师马喆诚、早稻田大学研究生梁垿、大疆工程师王波。感谢他们对本书的付梓而做出的贡献。此外，我还要感谢我的女朋友易慧感谢你在生活中对我的各种好，我爱你！

为了让国内读者在第一时间读到这本畅销国外技术著作，出版社和我都加快了工作进度，但时间紧、任务重，再加之本人水平有限，翻译工作中难免会出现一些失误。欢迎读者将阅读过程中发现的问题发送至我的邮箱（xujing46@163.com）。

本书英文版的副书名是「Data Wrangling with Pandas, Numpy, and Ipython」，其中 Wrangling 是一个很难直译的词汇，它的原意是争执、争论，但在书中它描述的是将数据进行规整、处理的意思。希望读者读完本书后，可以使用好 pandas、Numpy 和 python 这些工具，更好地完成数据处理、分析的学习和工作。

Enjoy it!

徐敬

2018 年 5 月于中国工商银行合肥后台中心

## 使用代码示例

可以通过本书的 Github 仓库获取本书每一章中的数据文件和相关材料。Github 仓库地址：[wesm/pydata-book: Materials and IPython notebooks for "Python for Data Analysis" by Wes McKinney, published by O'Reilly Media](https://github.com/wesm/pydata-book)

本书的目的在于帮助你完成工作。一般来说，本书提供的示例代码，你可以在你的程序或文档中使用而无须联系我们获取许可，除非你需要重造大量代码。举例来说，使用本书中的代码段编写程序无须授权许可，但销售或发行 D'reillyi 图书的 CD-ROM 代码示例则需要许。引用本书代码回答问题不需要许可，但在你的产品文档中大量使用本书示例代码则需要许可。

我们鼓励注明资料来源的行为，但这并不是必需的。来源注明通常包括书名、作者、出版社及 ISBN。如果你认为你对本书示例代码的使用超过了正常使用范围或者需要以上介绍的授权许可，请联系 permisions@oreilly.com

## 致谢

本书是全世界很多人多年来富有成效的讨论、协作和支持的成果。我想对他们中的一些代表致以谢意。

怀念：John D. Hunter (1968-2012)

我们亲爱的朋友和同行 John D. Hunter 在经历了一场与结肠癌的战斗后，于 2012 年 8 月 28 日离开了世界。那时正是我完成本书第版最终手稿后不久。

John 对 Python 科学计算和数据社区的影响之大难以估量，他给我们留下的遗产价值非凡。

除了在 2000 年初期开发 matplotlib 之外（那时 Python 还没有当下如此流行），他还帮助造了一代核心开源开发者的文化，如今这些开发者已经成为 Python 生态系统的顶梁柱，而 Python 生态系统对于现如今的我们来说似乎是理所当然的。

在 2010 年 1 月，我开源生涯的早期，那时候 pandas 刚刚发布了 0.1 版有幸结识了 John。即便在最黑暗的时期，他的才华和指导仍在帮助我推动 pandas 前进，实现 Python 成为数据分析第一语言的愿景。

John 与 Ipython、Jupyter 项目的先锋 Fernando Brian Granger 及其他很多 Python 社区的倡议人联系紧密。我们四人曾经希望共同写作一本书，但只有我个人时间最为自由，所以这个想法被搁置了。我非常确信他会为过去 5 年中我们个人及我们社区所取得的成就感到骄傲。

第 2 版致谢（2017)

距离我在 2012 年 7 月完成第 1 版手稿已经 5 年了。很多事情都发生了变化。Python 社区获得了极大的成长，围绕 Python 的开源软件生态系统也十分繁荣。pandas 核心开发者孜孜不倦的付出，使得 pandas 项目高速成长，也使得 pandas 的用户群体遍布 Python 数据科学生态系统的各个角落，没有他们本书将不会存在。pandas 的核心开发者包括但不限于：Tom Augspurger、Joris van den Bossche、Chris Bartak、Philip Cloud、gtfyoung、Andy Hayden、Masaaki Horikoshi、Stephan Hoyer、Adam Klein、Wouter、Overmeire Jeff Reback、Chang She、Skipper Seabold、Jeff Tratner 和 y-p。

在第 2 版的实际写作过程中，非常感谢 D'reillyk 的工作人员在写作进程中给予的耐心帮助。他们是 Marie Beaugureau、Ben Lorica：和 Colleen Toporek。我再次得到了优秀技术审阅人的支持，他们是 Tom Augpurger、Paul Barry、Hugh Brown、Jonathan Coe 和 Andreas Muller。感谢你们。

本书的第 1 版已经被翻译成多种语言，包括汉语、法语、德语、日语、韩语和俄语。将本书译给外国读者，是一份工作量大且缺少关注的付出。感谢你们帮助全世界更多人士学会如何编程及使用数据分析工具。

在过去几年中，Cloudera 和 Two Sigma 投资公司对我的持续开源开发工作的支持使我感到十分幸运。由于开源项目相对于用户基数的比例越来越小，向重要开源项目提供开发支持变得越来越重要。这是一件值得去做的正确工作

第 1 版致谢（2012)

## 目录

第1章 准备工作

第2章 Python语法基础，IPython和Jupyter Notebooks

第3章 Python的数据结构、函数和文件

第4章 NumPy基础：数组和矢量计算

第5章 pandas入门

第6章 数据加载、存储与文件格式

第7章 数据清洗和准备

第8章 数据规整：聚合、合并和重塑

第9章 绘图和可视化

第10章 数据聚合与分组运算

第11章 时间序列

第12章 pandas高级应用

第13章 Python建模库介绍

第14章 数据分析案例

附录A NumPy高级应用

附录B 更多关于IPython的内容（完）